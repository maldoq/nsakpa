{% extends 'base/dashboard/base.html' %}
{% load static %}
{% block title %}Détail de la Notification{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/dashboard/notification_detail.css' %}">

<div style="height: 30px;"></div>

<div class="content-wrapper">
    <!-- En-tête -->
    <div class="page-header">
        <div class="header-left">
            <h1>Détail de la Notification</h1>
            <p class="text-muted">Consultez les informations de cette notification</p>
        </div>
        <div class="header-right">
            <a href="{% url 'admin_notifications' %}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Retour aux notifications
            </a>
        </div>
    </div>

    <!-- Détails de la notification -->
    <div class="notification-details">
        <h2>{{ notification.title }}</h2>
        <p>{{ notification.message }}</p>
        <p><strong>Type:</strong> {{ notification.get_type_display }}</p>
        <p><strong>Niveau:</strong> {{ notification.get_level_display }}</p>
        <p><strong>Date de création:</strong> {{ notification.created_at }}</p>
        {% if notification.is_read %}
        <p><strong>Date de lecture:</strong> {{ notification.read_at }}</p>
        {% endif %}
        {% if notification.is_archived %}
        <p><strong>Date d'archivage:</strong> {{ notification.archived_at }}</p>
        {% endif %}
    </div>

    <!-- Détails de la commande (si la notification est de type "order") -->
    {% if notification.type == 'order' and order %}
    <div class="order-details">
        <h2>Détails de la commande</h2>

        <!-- Suivi de progression -->
        <!-- <div class="tracking-progress">
            <div class="progress-fill" style="width: 50%;"></div>
            
            <div class="tracking-step completed">
                <div class="step-icon">
                    <i class="fas fa-check"></i>
                </div>
                <div class="step-label">Commande</div>
            </div>
            
            <div class="tracking-step active">
                <div class="step-icon">
                    <i class="fas fa-box"></i>
                </div>
                <div class="step-label">Traitement</div>
            </div>
            
            <div class="tracking-step">
                <div class="step-icon">
                    <i class="fas fa-shipping-fast"></i>
                </div>
                <div class="step-label">Expédition</div>
            </div>
            
            <div class="tracking-step">
                <div class="step-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="step-label">Livraison</div>
            </div>
        </div> -->

        <!-- Grille des détails -->
        <div class="details-grid">
            <!-- Informations de livraison -->
            <div class="detail-section">
                <h3>Adresse de livraison</h3>
                <div class="info-box">
                    <p>{{ order.customer.first_name }} {{ order.customer.last_name }}</p>
                    {{ order.shipping_address_text|linebreaksbr }}
                </div>
            </div>

            <!-- Méthode de paiement -->
            <div class="detail-section">
                <h3>Méthode de paiement</h3>
                <div class="info-box">
                    {% if order.payment_method == 'card' %}
                    <p><i class="fas fa-credit-card"></i> Carte bancaire</p>
                    {% if order.payment_details.cardLastFour %}
                    <p class="card-info">**** **** **** {{ order.payment_details.cardLastFour }}</p>
                    {% endif %}
                    {% elif order.payment_method == 'delivery' %}
                    <p><i class="fas fa-truck"></i> Paiement à la livraison</p>
                    <p class="card-info">Espèces à la réception</p>
                    {% else %}
                    <p><i class="fas fa-money-bill"></i> {{ order.get_payment_method_display }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Date de livraison estimée -->
            <div class="detail-section">
                <h3>Livraison estimée</h3>
                <div class="info-box delivery-estimate">
                    <i class="fas fa-truck"></i>
                    <div>
                        <p class="delivery-date">{{ order.estimated_delivery_date|date:"l j F Y"|capfirst }}</p>
                        <p class="delivery-info">Livraison standard gratuite</p>
                    </div>
                </div>
            </div>

            <!-- Numéro de suivi -->
            <div class="detail-section">
                <h3>Suivi de commande</h3>
                <div class="info-box">
                    {% if order.tracking_number %}
                    <p>Numéro de suivi: <strong>{{ order.tracking_number }}</strong></p>
                    {% else %}
                    <p>Un email vous sera envoyé avec le numéro de suivi dès que votre colis sera expédié.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Récapitulatif des articles -->
        <div class="order-summary">
            <h3>Récapitulatif des articles</h3>

            <div class="order-items">
                {% for item in items %}
                <div class="order-item">
                    {% if item.product and item.product.images.exists %}
                    <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product_name }}">
                    {% else %}
                    <img src="{% static 'img/placeholder.jpg' %}" alt="{{ item.product_name }}">
                    {% endif %}
                    <div class="item-details">
                        <h4>{{ item.product_name }}</h4>
                        {% if item.options %}
                        <p class="item-options">
                            {% for key, value in item.options.items %}
                            {{ key }}: {{ value }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                        {% endif %}
                        <span class="item-quantity">Quantité: {{ item.quantity }}</span>
                    </div>
                    <div class="item-price">{{ item.unit_price }} F CFA x {{ item.quantity }} = {{ item.total_price }} F CFA</div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <i class="fas fa-box-open"></i>
                    <p>Aucun article dans cette commande</p>
                </div>
                {% endfor %}
            </div>

            <!-- Total de la commande -->
            <div class="order-total">
                <div class="total-line">
                    <span>Sous-total</span>
                    <span>{{ order.subtotal }} F CFA</span>
                </div>
                <div class="total-line">
                    <span>TVA (20%)</span>
                    <span>{{ order.tax_amount }} F CFA</span>
                </div>
                <div class="total-line">
                    <span>Livraison</span>
                    <span>{% if order.shipping_cost == 0 %}Gratuite{% else %}{{ order.shipping_cost }} F CFA{% endif %}</span>
                </div>
                <div class="total-line final-total">
                    <span>Total</span>
                    <span>{{ order.total_amount }} F CFA</span>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}